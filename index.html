<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Driver Daily Log</title>
<style>
  :root { --bg:#0b1016; --panel:#131b24; --muted:#8291a3; --accent:#4cc38a; --danger:#ff6b6b; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#e7eef7;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  h1{font-size:24px;margin:6px 0 14px}
  .card{background:var(--panel);border:1px solid #1e2a36;border-radius:12px;padding:14px;margin-bottom:14px}
  label{display:block;font-size:12px;text-transform:uppercase;letter-spacing:.05em;color:var(--muted);margin-bottom:6px}
  input, select, button{width:100%;padding:10px;border-radius:8px;border:1px solid #263240;background:#0f1620;color:#e7eef7;font-size:15px}
  input[readonly]{opacity:.85}
  .row3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .row4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .row2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .totals{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .flex{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{background:var(--accent);border:0;color:#08120e;font-weight:700;cursor:pointer;padding:10px 14px;border-radius:10px}
  .btn.secondary{background:#0f1620;color:#e7eef7;border:1px solid #2a394a}
  .btn.danger{background:var(--danger);color:#1b0d0d}
  .small{font-size:12px}
  .muted{color:var(--muted)}
  .status{margin-left:auto;font-size:12px;color:var(--muted)}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{border-top:1px solid #233142;padding:8px;text-align:left}
  th{color:#b9c7d6;font-size:12px;text-transform:uppercase;letter-spacing:.05em}
  .right{text-align:right}
  @media (max-width:720px){
    .row4,.totals,.row2,.row3{grid-template-columns:1fr}
    .status{width:100%;margin-top:6px}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Driver Daily Log</h1>

  <!-- Driver info -->
  <div class="card">
    <div class="row3">
      <div>
        <label>Date</label>
        <input id="logDate" type="date">
      </div>
      <div>
        <label>Driver Name</label>
        <input id="driverName" type="text" placeholder="Enter driver name">
      </div>
      <div>
        <label>Truck #</label>
        <input id="truckNum" type="text" placeholder="Enter truck #">
      </div>
    </div>
  </div>

  <!-- Trip header -->
  <div class="card">
    <div class="row4">
      <div>
        <label>Start Miles</label>
        <input id="startMiles" type="number" inputmode="numeric" placeholder="Start miles">
      </div>
      <div>
        <label>End Miles</label>
        <input id="endMiles" type="number" inputmode="numeric" placeholder="End miles">
      </div>
      <div>
        <label>Start Time</label>
        <input id="startTime" type="text" placeholder="HH:MM">
      </div>
      <div>
        <label>End Time</label>
        <input id="endTime" type="text" placeholder="HH:MM">
      </div>
    </div>
    <div class="totals" style="margin-top:12px">
      <div>
        <label>Total Miles</label>
        <input id="totalMiles" type="text" readonly>
      </div>
      <div>
        <label>Total Time (hh:mm)</label>
        <input id="totalTime" type="text" readonly>
      </div>
      <div>
        <label>Total Detention (hh:mm)</label>
        <input id="totalDetention" type="text" readonly>
      </div>
      <div>
        <label>Gross Pay ($)</label>
        <input id="grossPay" type="text" readonly>
      </div>
    </div>
    <div class="row2" style="margin-top:12px">
      <div>
        <label>Rate Per Mile ($)</label>
        <input id="rateMile" type="number" step="0.01" placeholder="e.g. 0.50">
      </div>
      <div>
        <label>Hourly Rate ($)</label>
        <input id="rateHour" type="number" step="0.01" placeholder="e.g. 25.00">
      </div>
    </div>
    <div class="flex" style="margin-top:12px">
      <button class="btn" id="addStop" type="button">+ Add Stop</button>
      <button class="btn secondary" id="exportCsv" type="button">Export CSV</button>
      <span class="status" id="saveStatus">Not saved</span>
    </div>
  </div>

  <!-- Stops table (same as before)… -->
  <div class="card">
    <table id="stopsTable" style="display:none">
      <thead>
        <tr>
          <th>#</th><th>Type</th><th>Location</th><th>Arrive</th><th>Depart</th><th>Duration</th><th>Detention</th><th>Value (hrs)</th><th></th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr><th colspan="6" class="right">Total Detention</th><th id="tfootDet">0:00</th><th id="tfootVal">0</th><th></th></tr>
      </tfoot>
    </table>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // === existing helpers (same as before)… ===
  function num(v){const n=parseFloat(String(v).replace(/,/g,''));return isNaN(n)?0:n;}
  function tToMin(t){if(!t) return 0;const [h,m]=t.split(':').map(Number);return h*60+m;}
  function minToHHMM(min){min=Math.max(0,Math.round(min));return `${Math.floor(min/60)}:${String(min%60).padStart(2,'0')}`;}
  function spanMin(a,b){let s=tToMin(a), e=tToMin(b);if(e<s) e+=1440;return e-s;}
  function detentionFrom(mins){const over=mins-60;if(over<=0) return 0;return Math.ceil(over/15)*15;}

  const startMiles=document.getElementById('startMiles');
  const endMiles=document.getElementById('endMiles');
  const startTime=document.getElementById('startTime');
  const endTime=document.getElementById('endTime');
  const totalMiles=document.getElementById('totalMiles');
  const totalTime=document.getElementById('totalTime');
  const totalDetention=document.getElementById('totalDetention');
  const grossPay=document.getElementById('grossPay');
  const rateMile=document.getElementById('rateMile');
  const rateHour=document.getElementById('rateHour');
  const tfootVal=document.getElementById('tfootVal');

  const stops=[]; // simplified for this snippet

  function calcGrossPay(){
    const miles=num(totalMiles.value);
    const rpm=num(rateMile.value);
    const hr=num(rateHour.value);
    const val=num(tfootVal.textContent);
    const pay=(miles*rpm)+(hr*val);
    grossPay.value = pay ? pay.toFixed(2) : '';
  }

  function recalcTripTotals(){
    const miles=num(endMiles.value)-num(startMiles.value);
    totalMiles.value=Math.max(0,miles);
    if(startTime.value&&endTime.value){ totalTime.value=minToHHMM(spanMin(startTime.value,endTime.value)); }
    // detention + value handled elsewhere
    calcGrossPay();
  }

  [startMiles,endMiles,startTime,endTime,rateMile,rateHour].forEach(el=>{
    el.addEventListener('input', recalcTripTotals);
  });

  // you’ll also want to call calcGrossPay() inside your stops refresh()
  // so whenever values change, gross pay recalculates.
});
</script>
</body>
</html>
